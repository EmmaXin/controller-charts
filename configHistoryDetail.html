<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Angular Material style sheet -->
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="css/onos/opensans.css">
    <link rel="stylesheet" href="css/onos/onos.css">
    <link rel="stylesheet" href="css/onos/onos-theme.css">
    <link rel="stylesheet" href="css/onos/common.css">

    <!-- Angular Material requires Angular.js Libraries -->
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-route.min.js"></script>
    <script src="./node_modules/oclazyload/dist/ocLazyLoad.min.js"></script>
    <!--<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-animate.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-aria.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-messages.min.js"></script>-->

    <!-- Angular Material Library -->
    <!--<script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>-->

    <script src="./node_modules/lodash/lodash.min.js"></script>
</head>

<body ng-app="myApp" ng-cloak>

    <a href="#red">Red</a>

    <div ng-view></div>

    <!-- Your application bootstrap  -->
    <script type="text/javascript">
        var configHistoryDetailCurrent = {
            id: '20170501011000000',
            modified: '2017-05-01 01:10:00.000',
            modifiedBy: 'mars',
            description: 'Device had added; Link had added',
            networkCfg: {
                global: {
                    reservedSubnet: [
                        "192.168.1.0/24",
                        "192.168.2.0/24",
                        "192.168.3.0/24",
                        "192.168.4.0/24",
                        "192.168.5.0/24",
                        "192.168.6.0/24",
                        "192.168.7.0/24",
                        "192.168.8.0/24",
                        "192.168.9.0/24",
                        "192.168.10.0/24",
                        "192.168.11.0/24",
                        "192.168.12.0/24",
                        "192.168.13.0/24",
                        "192.168.14.0/24",
                        "192.168.15.0/24",
                        "192.168.16.0/24",
                        "192.168.17.0/24",
                        "192.168.18.0/24",
                        "192.168.19.0/24",
                        "192.168.20.0/24",
                        "192.168.21.0/24",
                        "192.168.22.0/24",
                        "192.168.23.0/24",
                        "192.168.24.0/24",
                        "192.168.25.0/24"
                    ],
                    reservedVlanRange: {
                        begin: 4001,
                        end: 4094
                    }
                }
            }
        };

        angular.module("myApp", ['ngRoute', 'oc.lazyLoad'])
            .config(function ($routeProvider) {
                $routeProvider
                    .when("/red", {
                        templateUrl: "configHistoryDetail/configHistoryDetail.html",
                        controller: 'OvConfigHistoryDetailCtrl',
                        resolve: {
                            ctrl: ['$ocLazyLoad', function ($ocLazyLoad) {
                                return $ocLazyLoad.load('configHistoryDetail/configHistoryDetail.js');
                            }]
                        }
                    });
            })
            .factory('WebSocketService', function ($rootScope) {
                var _name = 'WebSocketService',
                    _handlers = {};

                // $rootScope.$on('hello', function () {
                //     var key = arguments[1][0],
                //         data = arguments[1][1];
                //     setTimeout(function() {
                //         console.log('received ' + key + ' data: ' + JSON.stringify(data));
                //     }, 0);
                // });

                return {
                    bindHandlers: function (handlers) {
                        angular.forEach(handlers, function (fn, key) {
                            this[key] = this[key] || {};
                            this[key].fn = fn;
                        }, _handlers);
                        // _handlers = handlers;
                    },
                    bindResponseData: function (responses) {
                        angular.forEach(responses, function (data, key) {
                            this[key] = this[key] || {};
                            this[key].data = data;
                        }, _handlers);
                    },
                    sendEvent: function (key, data) {
                        console.log(_name + ': sendEvent: ' + key + ' data: ' + JSON.stringify(data));

                        //$rootScope.$emit('hello', [key, data]);

                        if (key.endsWith('Request')) {
                            var respKey = key.substring(0, key.length - 'Request'.length) + 'Response';
                            if (_handlers[respKey] && typeof _handlers[respKey].fn === 'function') {
                                setTimeout(function () {
                                    console.log('call ' + respKey);
                                    var respData = _handlers[respKey].data || null;
                                    _handlers[respKey].fn(respData);
                                    //_handlers[respKey]({hello: 'hello'});
                                }, 0);
                            } else {
                                console.log('response handler not found');
                            }
                        } else {
                            console.log('unrecognised key');
                        }
                    }
                };
            })
            .run(['$location', 'WebSocketService', function ($location, wss) {
                wss.bindResponseData({
                    configHistoryDetailDataResponse: configHistoryDetailCurrent
                });
                $location.path('/red').search('from', 'somewhere').search('id', 'hello');
            }]);
    </script>

</body>

</html>